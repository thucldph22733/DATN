<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <meta name="description" content="POS - Bootstrap Admin Template">
    <meta name="keywords"
          content="admin, estimates, bootstrap, business, corporate, creative, invoice, html5, responsive, Projects">
    <meta name="author" content="Dreamguys - Bootstrap Admin Template">
    <meta name="robots" content="noindex, nofollow">
    <title>Sneaker Shop - Admin</title>

    <link rel="shortcut icon" type="image/x-icon" href="/images/img/icon.png">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/animate.css">
    <link rel="stylesheet" href="/plugins/owlcarousel/owl.carousel.min.css">
    <link rel="stylesheet" href="/plugins/owlcarousel/owl.theme.default.min.css">
    <link rel="stylesheet" href="/plugins/select2/css/select2.min.css">
    <link rel="stylesheet" href="/css/bootstrap-datetimepicker.min.css">
    <link rel="stylesheet" href="/plugins/icons/flags/flags.css">
    <link rel="stylesheet" href="/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="/plugins/fontawesome/css/fontawesome.min.css">
    <link rel="stylesheet" href="/plugins/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="/plugins/icons/feather/feather.css">
    <link rel="stylesheet" href="/plugins/simpleline/simple-line-icons.css">
    <link rel="stylesheet" href="/plugins/toastr/toatr.css"/>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/quagga"></script>
    <script type="text/javascript" src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/AlertifyJS/1.13.1/css/alertify.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/AlertifyJS/1.13.1/css/themes/default.min.css"/>
</head>

<style>
    .row {
        display: flex;
        flex-wrap: wrap;
        margin-right: -15px;
        margin-left: -15px;
    }

    .col-lg-3, .col-sm-6 {
        position: relative;
        min-height: 1px;
        padding-right: 15px;
        padding-left: 15px;
    }

    .tab_content.active .productset {
        display: flex;
        flex-direction: column;
        background-color: #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        border-radius: 8px;
        overflow: hidden;
    }

    .productsetimg {
        position: relative;
        text-align: center;
    }

    .productsetimg img {
        max-width: 100%;
        height: auto;
        border-bottom: 1px solid #f1f1f1;
    }

    .check-product {
        position: absolute;
        top: 10px;
        right: 10px;
        color: #fff;
        background-color: #28a745;
        padding: 5px;
        border-radius: 50%;
    }

    .productsetcontent {
        padding: 15px;
        text-align: center;
    }

    .productsetcontent h3 {
        font-size: 18px;
        color: #333;
        margin: 0 0 10px;
    }

    .productsetcontent h4 {
        font-size: 16px;
        color: #666;
    }

    .btn-outline-warning {
        border: 1px solid #ffc107;
        color: #ffc107;
        background-color: #fff;
        transition: all .2s ease-in-out;
    }

    .btn-outline-warning:hover {
        background-color: #ffc107;
        color: #fff;
    }

    .productset h6 {
        position: absolute;
        top: 15px;
        left: 15px;
        background-color: rgba(0, 0, 0, 0.6);
        color: #fff;
        padding: 5px;
        border-radius: 3px;
    }
</style>

<style>
    .alertify .ajs-message {
        background-color: black;
        color: #ffffff;
    }

    /* Thay đổi màu nền của tiêu đề */
    .alertify .ajs-header {
        background-color: coral;
        color: #ffffff;
    }

    /* Thay đổi màu nền của các nút */
    .alertify .ajs-buttons .ajs-ok {
        background-color: #2ecc71;
        color: #ffffff;
    }
</style>
<style>
    #video {
        display: none;
    }

    #stopButton {
        display: none;
    }

    .color-box {
        width: 25px;
        height: 25px;
        display: inline-block;
        border: 1px solid #000;
        margin: 0 5px;
    }
</style>
<body>
<div class="main-wrapper">
    <div class="header">
        <div class="header-left active">
            <a href="/manage" class="logo">
                <img src="/images/img/logo.png" alt="">
            </a>
            <a href="/manage" class="logo-small">
                <img src="/images/img/logo-small.png" alt="">
            </a>
            <a id="toggle_btn" href="javascript:void(0);">
            </a>
        </div>

        <a id="mobile_btn" class="mobile_btn" href="#sidebar">
            <span class="bar-icon">
            <span></span>
            <span></span>
            <span></span>
            </span>
        </a>

        <ul class="nav user-menu">

            <li class="nav-item dropdown has-arrow flag-nav">
                <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button">
                    <i class="flag flag-vn"></i>
                </a>
            </li>

            <li class="nav-item dropdown">
                <a href="javascript:void(0);" class="dropdown-toggle nav-link" data-bs-toggle="dropdown">
                    <img src="/images/img/icons/notification-bing.svg" alt="img"> <span
                        class="badge rounded-pill" th:text="${soThongBao}"></span>
                </a>
                <div class="dropdown-menu notifications">
                    <div class="topnav-dropdown-header">
                        <span class="notification-title">Notifications</span>
                        <a href="javascript:void(0)" class="clear-noti"> Clear All </a>
                    </div>
                    <div class="noti-content">
                        <ul class="notification-list">
                            <th:block th:each="x : ${listThongBao}">
                                <li th:if="${x.trangThai == 3}" class="notification-message">
                                    <a href="/manage/bill/online">
                                        <div class="media d-flex">
                                                <span class="avatar flex-shrink-0">
                                                    <img alt="" src="/images/img/profiles/avatar-02.jpg">
                                                </span>
                                            <div class="media-body flex-grow-1">
                                                <p class="noti-details">
                                                        <span class="noti-title"
                                                              th:text="${x.khachHang.hoTenKH}"></span>
                                                    <span th:text="${x.noiDungTB}"></span>
                                                    <span class="noti-title" th:text="${x.hoaDon.maHD}"></span>
                                                </p>
                                                <p class="noti-time">
                                                    <span class="notification-time"
                                                          th:text="${#dates.format(x.tgTB, 'HH:mm yyyy-MM-dd')}">
                                                    </span>
                                                </p>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                            </th:block>
                        </ul>
                    </div>
                    <div class="topnav-dropdown-footer">
                        <a href="activities.html">View all Notifications</a>
                    </div>
                </div>
            </li>

            <li class="nav-item dropdown has-arrow main-drop">
                <a href="javascript:void(0);" class="dropdown-toggle nav-link userset" data-bs-toggle="dropdown">
                        <span class="user-img"><img
                                th:src="@{'/images/imgsNhanVien/'+${session.staffLogged.AnhNV}}"
                                alt="">
                        <span class="status online"></span></span>
                </a>
                <div class="dropdown-menu menu-drop-user">
                    <div class="profilename">
                        <div class="profileset">
                                <span class="user-img"><img
                                        th:src="@{'/images/imgsNhanVien/'+${session.staffLogged.AnhNV}}"
                                        alt="">
                                    <span class="status online"></span></span>
                            <div class="profilesets">
                                <h6 th:text="${session.staffLogged.hoTenNV}"></h6>
                                <h5 th:text="${session.staffLogged.chucVu.tenCV}"></h5>
                            </div>
                        </div>
                        <hr class="m-0">
                        <a class="dropdown-item me-2 delete-button2" th:data-ql-url="@{'/logout'}">Quản lý Cửa
                            Hàng</a>
                        <a class="dropdown-item" href="profile.html">
                            <i class="me-2" data-feather="user"></i> My Profile
                        </a>
                        <a class="dropdown-item" href="/manage/change-password"><i class="me-2"
                                                                                   data-feather="settings"></i>Change
                            passwoord</a>
                        <hr class="m-0">
                        <a class="dropdown-item logout pb-0" href="/logout"><img src="/images/img/icons/log-out.svg"
                                                                                 class="me-2" alt="img">Logout</a>
                    </div>
                </div>
            </li>
        </ul>

        <div class="dropdown mobile-user-menu">
            <a href="javascript:void(0);" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"
               aria-expanded="false"><i class="fa fa-ellipsis-v"></i></a>
            <div class="dropdown-menu dropdown-menu-right">
                <a class="dropdown-item" th:data-ql-url="@{'/logout'}">Quản lý Cửa Hàng</a>
                <!--                    <a class="dropdown-item" href="/order/">Vận chuyển</a>-->
                <a class="dropdown-item" href="profile.html">Thông tin cá nhân</a>
                <a class="dropdown-item" href="/manage/change-password">Cài đặt</a>
                <a class="dropdown-item" href="signin.html">Đăng xuất</a>
            </div>
        </div>

    </div>
    <div class="page-wrapper ms-0">
        <div class="content">
            <section class="comp-section">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card bg-white">
                            <div class="card-body">
                                <ul class="nav nav-tabs nav-tabs-solid nav-tabs-rounded nav-justified">
                                    <li class="nav-item">
                                        <a class="nav-link active"
                                           href="#solid-rounded-justified-tab1"
                                           data-bs-toggle="tab">Bán hàng</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link"
                                           href="#solid-rounded-justified-tab2"
                                           data-bs-toggle="tab">Hóa đơn hôm nay</a>
                                    </li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane show active" id="solid-rounded-justified-tab1">
                                        <div class="row">
                                            <div class="col-lg-7 col-sm-12 tabs_wrapper">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <div class="table-top">
                                                            <form method="get" action="/ban-hang/search">
                                                                <div class="search-set">
                                                                    <div class="search-path">
                                                                        <button class="btn btn-searchset" type="submit">
                                                                            <img
                                                                                    src="/images/img/icons/search-white.svg"
                                                                                    alt="img"></button>
                                                                    </div>
                                                                    <div>
                                                                        <div>
                                                                            <input
                                                                                    type="search"
                                                                                    class="form-control form-control-sm"
                                                                                    name="keyword"
                                                                                    placeholder="Tìm kiếm..."
                                                                                    aria-controls="DataTables_Table_0">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </form>
                                                            <div class="wordset text-center">
                                                                <ul>
                                                                    <li>
                                                                        <video
                                                                                style="border: 1px solid"
                                                                                id="video"
                                                                                autoplay="true"
                                                                                width="200px"
                                                                                height="120px"
                                                                        ></video>
                                                                    </li>
                                                                </ul>
                                                                <div>
                                                                    <button id="scanButton"
                                                                            class="btn btn-outline-dark">Quét QR
                                                                    </button>
                                                                    <button id="stopButton" class="btn btn-danger mt-2">
                                                                        Tắt Video
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="tabs_container">
                                                    <div class="row">
                                                        <div th:if="${nullHoaDon}"
                                                             class="alert alert-success text-center">
                                                            <h3 th:text="${nullHoaDon}"></h3>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <th:block th:each="product : ${listSanPham}">
                                                            <div class="col-lg-3 col-sm-6">
                                                                <div class="tab_content active">
                                                                    <div class="productset flex-fill ">
                                                                        <div class="productsetimg">
                                                                            <img th:src="@{'/images/imgsProducts/'+ ${product.hinhAnh}}"
                                                                                 alt="img">
                                                                            <h6>[[${product.soLuong}]]</h6>
                                                                            <div class="check-product">
                                                                                <i class="fa fa-check"></i>
                                                                            </div>
                                                                        </div>
                                                                        <div class="productsetcontent">
                                                                            <h3>[[${product.tenGiay}]]</h3>
                                                                            <h3 th:text=" ${#numbers.formatDecimal(product.giaBan, 0, 'COMMA', 2, 'POINT').replaceAll('([,.])0+$', '$1').replaceAll('\\.$', '')} + ' đ'"></h3>
                                                                            <h4 th:text="${product.mauSac}"></h4>
                                                                            <a
                                                                                    th:href="@{'/ban-hang/chon-size/' + ${product.idGiay}+'/'+${product.mauSac} }"
                                                                                    class="btn btn-outline-warning m-3">
                                                                                Chọn</a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </th:block>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-lg-5 col-sm-12 ">
                                                <div class="order-list">
                                                    <div class="orderid">
                                                        <nav class="navbar navbar-expand-lg">
                                                            <a class="btn" th:href="@{/ban-hang/add-cart}">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="25"
                                                                     height="25"
                                                                     fill="currentColor"
                                                                     class="bi bi-person-add" viewBox="0 0 16 16">
                                                                    <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0Zm-2-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"/>
                                                                    <path d="M8.256 14a4.474 4.474 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10c.26 0 .507.009.74.025.226-.341.496-.65.804-.918C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4s1 1 1 1h5.256Z"/>
                                                                </svg>
                                                            </a>
                                                            <div class="collapse navbar-collapse shop__sidebar__size">
                                                                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                                                                    <div th:each="items : ${listHoaDon}">
                                                                        <li class="nav-item">
                                                                            <label class="text-center ms-2">
                                                                                <a class="btn btn-outline-dark"
                                                                                   th:href="@{'/ban-hang/cart/hoadon/'+ ${items.getIdHD()}}"
                                                                                   th:text="${items.maHD}">
                                                                                </a>
                                                                            </label>
                                                                        </li>
                                                                    </div>
                                                                </ul>
                                                            </div>
                                                            <div class="row">
                                                                <div th:if="${message}"
                                                                     class="alert alert-success text-center">
                                                                    <h3 th:text="${message}"></h3>
                                                                </div>
                                                            </div>
                                                        </nav>
                                                    </div>
                                                </div>
                                                <div class="card card-order">
                                                    <div class="card-body pt-0 mt-3">
                                                        <div class="totalitem">
                                                            <label class="fw-semibold fs-3 ">Giỏ hàng</label>
                                                            <h4 th:text="'Số sản phẩm: '+${tongSanPham}"></h4>
                                                            <a href="javascript:void(0);">Clear all</a>
                                                        </div>
                                                        <div class="product-table">
                                                            <ul class="product-lists">
                                                                <li>
                                                                    <div></div>
                                                                </li>
                                                                <li>
                                                                    <div>Sản phẩm</div>
                                                                </li>
                                                                <li>
                                                                    <div>Giá</div>
                                                                </li>
                                                                <li>
                                                                    <div>Thành tiền</div>
                                                                </li>
                                                                <li>
                                                                    <div></div>
                                                                </li>
                                                            </ul>
                                                            <ul>
                                                                <li>
                                                                    <div class="row">
                                                                        <div th:if="${messageGioHang}"
                                                                             class="alert alert-success text-center">
                                                                            <h3 th:text="${messageGioHang}"></h3>
                                                                        </div>
                                                                    </div>
                                                                </li>
                                                            </ul>
                                                            <th:block th:each="gioHang : ${gioHang}">
                                                                <ul class="product-lists">
                                                                    <li>
                                                                        <div class="productimg">
                                                                            <div class="productimgs">
                                                                                <img th:src="@{'/images/imgsProducts/'+ ${gioHang.chiTietGiay.hinhAnh.url1}}"
                                                                                     alt="img">
                                                                            </div>
                                                                            <div class="productcontet">
                                                                                <h4 th:text="${gioHang.chiTietGiay.giay.tenGiay}">
                                                                                    <a href="javascript:void(0);"
                                                                                       class="ms-2"
                                                                                       data-bs-toggle="modal"
                                                                                       data-bs-target="#edit"><img
                                                                                            src="/images/img/icons/edit-5.svg"
                                                                                            alt="img"></a>
                                                                                </h4>
                                                                                <div class="row">
                                                                                    <div class="productlinkset col-6">
                                                                                        <h5 th:text="${gioHang.chiTietGiay.size.soSize}"></h5>
                                                                                    </div>
                                                                                    <div class="col-6">
                                                                                        <!--                                                            <label class="color-box" th:style="'background-color: ' + ${gioHang.chiTietGiay.mauSac.maMau}"></label>-->
                                                                                        <span class="color-box"
                                                                                              th:style="'background-color:' +${gioHang.chiTietGiay.mauSac.maMau}"></span>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="increment-decrement">
                                                                                    <div class="input-groups">
                                                                                        <input style=" margin-top: 3px;border: none; font-weight: 700; font-size: 18pt; background-color: white;"
                                                                                               type="button" value="-"
                                                                                               class="button-minus dec button"
                                                                                               onclick="decrementQuantity(this)">
                                                                                        <input class="quantityInput"
                                                                                               oninput="updateTotalAmountAndGrandTotal(this)"
                                                                                               th:value="${gioHang.soLuong}"
                                                                                               style="width: 30px; text-align: center; border: none;"
                                                                                               type="text"
                                                                                               th:name="${gioHang.chiTietGiay.idCTG}"
                                                                                               min="1">

                                                                                        <input style="border: none; font-weight: 700; font-size: 14pt; background-color: white;"
                                                                                               type="button" value="+"
                                                                                               class="button-plus inc button a3 a5 a1 a-1"
                                                                                               onclick="incrementQuantity(this)">
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </li>
                                                                    <li>
                                                                        <div class="cart__price"
                                                                             th:text=" ${#numbers.formatDecimal(gioHang.chiTietGiay.giaBan, 0, 'COMMA', 2, 'POINT').replaceAll('([,.])0+$', '$1').replaceAll('\\.$', '')} + ' đ'"></div>
                                                                    </li>
                                                                    <li>
                                                                        <!--                                            <div th:text="${gioHang.donGia * gioHang.soLuong}"></div>-->
                                                                        <div class="cart__price totalAmount"
                                                                             id="thanhTien"
                                                                             th:text=" ${#numbers.formatDecimal(gioHang.chiTietGiay.giaBan * gioHang.soLuong, 0, 'COMMA', 2, 'POINT').replaceAll('([,.])0+$', '$1').replaceAll('\\.$', '')} + ' đ'"></div>
                                                                    </li>
                                                                    <li>
                                                                        <a class="btn"
                                                                           th:href="@{'/ban-hang/xoa-gio-hang/'+ ${gioHang.chiTietGiay.idCTG}}"
                                                                           onclick="return confirm('Bạn có muốn xóa sản phẩm không')">
                                                                            <img src="/images/img/icons/delete-2.svg"
                                                                                 alt="img">
                                                                        </a>
                                                                    </li>
                                                                </ul>
                                                            </th:block>
                                                        </div>
                                                        <div class="setvalue">
                                                            <ul>
                                                                <li>
                                                                    <h5>Tổng tiền </h5>
                                                                    <div class="grandTotal" id="tongTienSanPham"
                                                                         th:text=" ${#numbers.formatDecimal(tongTien, 0, 'COMMA', 2, 'POINT').replaceAll('([,.])0+$', '$1').replaceAll('\\.$', '')} + ' đ'"></div>

                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    <div class="split-card">
                                                        <div class="card-body">
                                                            <div class="row">
                                                                <div>
                                                                    <label class="fw-semibold fs-3 m-3">Tài
                                                                        khoản</label>
                                                                    <a class="btn btn-primary m-3" style="float: right"
                                                                       th:href="@{'/ban-hang/list-khach-hang'}">
                                                                        Chọn tài khoản
                                                                    </a>
                                                                </div>
                                                                <div th:if="${khachHang==null}">
                                                                    <label>Tên khách hàng : Khách lẻ</label>
                                                                </div>
                                                                <div th:if="${khachHang != null}" class="mt-5">
                                                                    <div class="setvalue">
                                                                        <ul>
                                                                            <li>
                                                                                <h5>Họ tên :</h5>
                                                                                <h5 th:text="${khachHang.hoTenKH}"></h5>
                                                                            </li>
                                                                            <li>
                                                                                <h5>Số điện thoại:</h5>
                                                                                <h5 th:text="${khachHang.sdtKH}"></h5>
                                                                            </li>
                                                                            <li>
                                                                                <h5>Email : </h5>
                                                                                <h5 th:text="${khachHang.emailKH}"></h5>
                                                                            </li>
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="split-card">
                                                        <div class="card-body pt-0 pb-2">
                                                            <div><label class="fw-semibold fs-3 m-3">Thanh toán</label>
                                                            </div>
                                                            <br>
                                                            <div class="setvalue">
                                                                <ul>
                                                                    <li style="margin-bottom: 20px;">
                                                                        <h5>Tạm tính :</h5>
                                                                        <h5 class="grandTotal" style="font-size: 13pt;"
                                                                            th:text=" ${#numbers.formatDecimal(tongTien, 0, 'COMMA', 2, 'POINT').replaceAll('([,.])0+$', '$1').replaceAll('\\.$', '')} + ' đ'"></h5>
                                                                    </li>
                                                                    <li style="margin-bottom: 20px;">
                                                                        <h5>
                                                                            <a type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop">Chọn khuyến mãi</a>
                                                                        </h5>

                                                                    <li style="margin-bottom: 20px;">
                                                                        <h5>Giá tiền giảm:</h5>
                                                                        <h5 class="grandTotal" style="font-size: 13pt;" th:text=" ${giaTienGiam} + ' đ'" id="tienGiam"></h5>
                                                                    </li>
                                                                    <form method="get">
                                                                        <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                                                                            <div class="modal-dialog modal-lg">
                                                                                <div class="modal-content">
                                                                                    <div class="modal-header">
                                                                                        <h5 class="modal-title" id="staticBackdropLabel" for="promotion-select">Danh sách Khuyễn mãi</h5>
                                                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                                    </div>
                                                                                    <div>
                                                                                        <div class="table-responsive">
                                                                                            <table class="table datanew" id="data-table">
                                                                                                <tbody>
                                                                                                <tr th:each="items : ${khuyenMai}">
                                                                                                    <td th:text="${items.maKM}"></td>
                                                                                                    <td th:text="${items.tenKM}"></td>
                                                                                                    <td>
                                                                                                        <button type="submit" class="btn btn-primary" th:formaction="@{'/ban-hang/chon-khuyen-mai/' + ${items.idKM}}">Áp dụng</button>
                                                                                                    </td>
                                                                                                </tr>
                                                                                                </tbody>
                                                                                            </table>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="modal-footer">
                                                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </form>
                                                                    </li>

                                                                    <li style="margin-bottom: 20px;">
                                                                        <h5>Tổng tiền sau khuyến mãi : </h5>
                                                                        <h5 class="text-danger" style="font-size: 13pt;"
                                                                            th:text=" ${#numbers.formatDecimal(tongTien, 0, 'COMMA', 2, 'POINT').replaceAll('([,.])0+$', '$1').replaceAll('\\.$', '')} + ' đ'"></h5>
                                                                        <h5 class="text-danger" id="tongTien"
                                                                            th:text="${tongTien} +' đ'"
                                                                            style="display: none; font-size: 13pt;">
                                                                        </h5>
                                                                    </li>

                                                                    <li style="margin-bottom: 20px;">
                                                                        <h5>Tiền khách đưa : </h5>
                                                                        <input type="number" name="tienKhachDua" min="1"
                                                                               id="tienKhachDua"
                                                                               class="form-control"
                                                                               oninput="tinhTienThua()"
                                                                               style="width: 300px "
                                                                        >
                                                                    </li>
                                                                    <li style="margin-bottom: 20px;">
                                                                        <h5><b>Tiền thừa:</b></h5>
                                                                        <h5>
                                                                            <label style="font-size: 13pt;"
                                                                                   id="tienThua"
                                                                                   name="tienThua"></label>
                                                                        </h5>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                            <div class="text-center">
                                                                <div class="dropdown mt-3">
                                                                    <!--                                                                    <a type="button" class="btn btn-primary" disabled-->
                                                                    <!--                                                                       th:href="@{'/ban-hang/thanh-toan'}"-->
                                                                    <!--                                                                       onclick="return confirm('Bạn có muốn thanh toán không')"-->
                                                                    <!--                                                                       style="background-color: #37517E;cursor: pointer;color: white;border: none;padding: 10px 20px;border-radius: 10px">-->
                                                                    <!--                                                                        Thanh toán-->
                                                                    <!--                                                                    </a>-->
                                                                    <button id="nutThanhToan" disabled
                                                                            class="btn btn-primary"
                                                                            style="background-color: #37517E;cursor: pointer;color: white;border: none;padding: 10px 20px;border-radius: 10px"
                                                                            data-bs-toggle="modal"
                                                                            data-bs-target="#exampleModal">
                                                                        Thanh toán
                                                                    </button>
                                                                    <!-- Modal -->
                                                                    <div class="modal fade" id="exampleModal"
                                                                         tabindex="-1"
                                                                         aria-labelledby="exampleModalLabel6"
                                                                         aria-hidden="true">
                                                                        <div class="modal-dialog modal-md text-center"
                                                                             style="width: 550px;">
                                                                            <div class="modal-content">
                                                                                <div class="modal-header">
                                                                                    <h1 class="modal-title fs-5"
                                                                                        id="exampleModalLabel6">Xác
                                                                                        nhận</h1>
                                                                                    <button type="button"
                                                                                            class="btn-close"
                                                                                            data-bs-dismiss="modal"
                                                                                            aria-label="Close"></button>
                                                                                </div>
                                                                                <div class="modal-body">
                                                                                    <div class="text-center" type="">Bạn
                                                                                        có chắc
                                                                                        muốn thanh toán
                                                                                    </div>
                                                                                </div>
                                                                                <div class="modal-footer text-center">
                                                                                    <a type="button"
                                                                                       class="btn btn-warning"
                                                                                       th:href="@{'/ban-hang/thanh-toan'}"
                                                                                       style="background-color: #37517E;height: 50px;cursor: pointer;color: white;padding: 10px 20px;border-radius: 10px;margin: auto; display: inline-block;"
                                                                                    >Thanh toán</a>
                                                                                    <button type="button"
                                                                                            style="background-color: #bb2d3b;height: 50px;color: white;;cursor: pointer;border: none;border-radius: 10px;margin: auto; display: inline-block"
                                                                                            class="btn btn-warning"
                                                                                            data-bs-dismiss="modal">Hủy
                                                                                    </button>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane" id="solid-rounded-justified-tab2">

                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <div class="table-responsive">
                                                            <div class="vertical-scroll scroll-demo">
                                                                <table class="table  datanew ">
                                                                    <thead>
                                                                    <tr>
                                                                        <th style="position: sticky; top: 0;background-color: #ff9f43; color: white;">
                                                                            Mã Hóa Đơn
                                                                        </th>
                                                                        <th style="position: sticky; top: 0;background-color: #ff9f43; color: white;">
                                                                            Thời gian tạo
                                                                        </th>
                                                                        <th style="position: sticky; top: 0;background-color: #ff9f43; color: white;">
                                                                            Thời gian thanh toán
                                                                        </th>
                                                                        <th style="position: sticky; top: 0;background-color: #ff9f43; color: white;">
                                                                            Trạng thái
                                                                        </th>
                                                                        <th style="position: sticky; top: 0;background-color: #ff9f43; color: white;">
                                                                            Khách hàng
                                                                        </th>
                                                                        <th style="position: sticky; top: 0;background-color: #ff9f43; color: white;">
                                                                            Tổng sản phẩm
                                                                        </th>
                                                                        <th style="position: sticky; top: 0;background-color: #ff9f43; color: white;">
                                                                            Tổng tiền
                                                                        </th>
                                                                        <th style="position: sticky; top: 0;background-color: #ff9f43; color: white;">
                                                                            Hành động
                                                                        </th>
                                                                    </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                    <th:block th:each="bill: ${listHoaDonHomNay}">
                                                                        <tr>
                                                                            <td th:text="${bill.maHD}"></td>
                                                                            <td th:text="${#dates.format(bill.tgTao, 'HH:mm yyyy-MM-dd')}"></td>

                                                                            <td th:if="${bill.tgThanhToan != null}"
                                                                                th:text="${#dates.format(bill.tgThanhToan, 'HH:mm yyyy-MM-dd')}"></td>
                                                                            <td th:if="${bill.tgThanhToan == null}">Chưa
                                                                                có
                                                                            </td>

                                                                            <td th:if="${bill.trangThai == 0}">HD Chờ
                                                                            </td>
                                                                            <td th:if="${bill.trangThai == 1}"
                                                                                style="color: #1536db">HD Thành công
                                                                            </td>
                                                                            <td th:if="${bill.trangThai == 2}"
                                                                                style="color: #db1515">HD Hủy
                                                                            </td>

                                                                            <td th:if="${bill.khachHang == null}">Khách
                                                                                vãng lai
                                                                            </td>
                                                                            <td th:if="${bill.khachHang != null}"
                                                                                th:text="${bill.khachHang.hoTenKH}"></td>

                                                                            <td th:text="${bill.tongSP}"></td>

                                                                            <td th:if="${bill.tongTienDG != null}"
                                                                                th:text="'₫'+${#numbers.formatDecimal(bill.tongTienDG, 0, 'COMMA', 2, 'POINT').replaceAll('([,.])0+$', '$1').replaceAll('\\.$', '')}"></td>
                                                                            <td th:if="${bill.tongTienDG == null}">₫ 0
                                                                            </td>

                                                                            <th>
                                                                                <i data-bs-toggle="tooltip"
                                                                                   title="Chỉnh sửa"
                                                                                   style="cursor: pointer; margin: 0 10px 0 20px;"
                                                                                   class="fe fe-edit-3"></i>

                                                                                <a th:if="${bill.trangThai == 1}"
                                                                                   th:href="@{'http://localhost:8081/ban-hang/bill/print/' + ${bill.idHD}}"
                                                                                   onclick="window.open(this.href, '_blank'); return false;">
                                                                                    <i class="fe fe-printer"
                                                                                       data-bs-toggle="tooltip" title=""
                                                                                       style="cursor: pointer; color: #ff9f43;"
                                                                                       data-bs-original-title="In hóa đơn"
                                                                                       aria-label="fe fe-printer"></i>
                                                                                </a>
                                                                                <a style="margin-left: 10px;"
                                                                                   th:if="${bill.trangThai == 0}"><i
                                                                                        class="si si-close"
                                                                                        data-bs-toggle="tooltip"
                                                                                        title="Hủy hóa đơn"></i></a>
                                                                            </th>
                                                                        </tr>
                                                                    </th:block>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</div>

<div th:if="${showModalKhachHang}" class="modal fade" id="chonTaiKhoan" tabindex="-1"
     aria-labelledby="exampleModalLabel3"
     aria-hidden="true"
     data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel3">Khách hàng</h5>
                <a type="button" th:href="@{'/ban-hang/cart/hoadon/'+ ${idHoaDon} }">
                    <span aria-hidden="true">×</span>
                </a>
            </div>
            <div class="modal-body">
                <form method="get" action="/ban-hang/search-khach-hang">
                    <div class="row">
                        <div class="col-4">
                            <input name="keyword" class="form-control" type="text" placeholder="Tên hoặc SDT">
                        </div>
                        <div class="col-3">
                            <button type="submit" class="btn btn-dark">Search</button>
                        </div>
                        <div class="col-2 offset-3" style="float:right">
                            <a class="btn" href="/ban-hang/khach-hang/viewAdd">
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                     class="bi bi-person-add" viewBox="0 0 16 16">
                                    <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0Zm-2-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"/>
                                    <path d="M8.256 14a4.474 4.474 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10c.26 0 .507.009.74.025.226-.341.496-.65.804-.918C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4s1 1 1 1h5.256Z"/>
                                </svg>
                            </a>
                        </div>
                    </div>
                </form>

                <table class="table mt-3 text-center">
                    <thead>
                    <tr>
                        <th>Mã</th>
                        <th>Họ tên</th>
                        <th>SDT</th>
                        <th>Trạng thái</th>
                        <th colspan="2">Action</th>
                    </tr>
                    </thead>
                    <tbdoy>
                        <th:block th:each="listKH : ${listKhachHang}">
                            <div th:if="${listKhachHang == null}" class="error-message text-center text-dark">Không
                                tìm
                                thấy khách hàng
                            </div>
                            <tr>
                                <td th:text="${listKH.maKH}"></td>
                                <td th:text="${listKH.hoTenKH}"></td>
                                <td th:text="${listKH.sdtKH}"></td>
                                <td th:text="${listKH.trangThai ==1 ? 'Đang hoạt động' : 'Ngừng hoạt động'}"></td>
                                <td>
                                    <a th:href="@{'/ban-hang/chon-khach-hang/'+ ${listKH.idKH}}"
                                       class="btn btn-outline-secondary">Chọn</a>
                                </td>
                            </tr>
                        </th:block>

                    </tbdoy>
                </table>
            </div>
        </div>
    </div>
</div>


<div th:if="${showModal}" class="modal fade" id="chonSize" tabindex="-1" aria-labelledby="exampleModalLabel"
     aria-hidden="true"
     data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Sản phẩm</h5>
                <a type="button" th:href="@{'/ban-hang/cart/hoadon/'+ ${idHoaDon} }">
                    <span aria-hidden="true">×</span>
                </a>
            </div>
            <div class="modal-body">
                <div class="row m-3">
                    <div class="col-6">
                        <img th:src="@{'/images/imgsProducts/'+ ${giay.chiTietGiayList.get(0).hinhAnh.url1}}" alt=""
                             height="400"
                             width="300">
                    </div>
                    <div class="col-6">
                        <div class="container">
                            <div class="row">
                                <div class="">
                                    <div class="text-left fs-2 fw-bolder">
                                        <label th:text="${giay.tenGiay}"></label>
                                    </div>
                                    <div class="text-left fs-3 fw-normal">
                                        <label th:text="${'Hãng : '+ giay.hang.tenHang}"></label>
                                    </div>
                                    <div class="text-left fs-4">
                                        <form action="/ban-hang/add-to-cart" method="get">
                                            <div class="">
                                                <h3>Số lượng</h3>
                                                <input type="number" name="soLuong" value="1" min="1"
                                                       class="form-control"/>
                                            </div>
                                            <div class="row">
                                                <div th:each="listChiTietGiay : ${listChiTietGiay}"
                                                     class="col-md-3">
                                                    <input style="height: 15px; width: 15px;margin-right: 10px;"
                                                           type="radio" th:name="idChiTietGiay"
                                                           th:value="${listChiTietGiay.idCTG}"
                                                           th:text="${listChiTietGiay.size.soSize}"
                                                           checked="true"/>
                                                </div>
                                            </div>
                                            <button type="submit" class="btn btn-secondary btn-center mt-3">
                                                Thêm giỏ hàng
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:if="${showModalAddKH}" class="modal fade" id="addKhachHang" tabindex="-1"
     aria-labelledby="exampleModalLabel5"
     aria-hidden="true"
     data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-md" role="document" style="width: 600px;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel5">Thêm Khách Hàng</h5>
                <a type="button" href="/ban-hang/list-khach-hang">
                    <span aria-hidden="true">×</span>
                </a>
            </div>
            <div class="modal-body">
                <form th:object="${addKH}" method="post"
                      th:action="@{/ban-hang/khach-hang/add}"
                      onsubmit="return validateAddKhachHang()">
                    <div class="row">
                        <div class="form-group">
                            <label>Họ tên</label>
                            <input type="text" th:field="*{hoTenKH}">
                        </div>
                        <div class="form-group">
                            <label>Sdt</label>
                            <input type="text" th:field="*{sdtKH}">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="text" th:field="*{emailKH}">
                        </div>
                    </div>
                    <div class="mt-3 text-center">
                        <button type="submit" class="btn btn-submit me-2">Submit</button>
                        <a href="/ban-hang/list-khach-hang" class="btn btn-cancel">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div th:if="${messageSuccess}" id="success" class="toast-container toast-top-right">
    <div class="toast toast-success" aria-live="polite" style="display: block;">
        <button type="button" class="toast-close-button" role="button"></button>
        <div class="toast-title">Thành Công</div>
        <div class="toast-message" th:text="${tb}"></div>
    </div>
</div>
<div th:if="${messageError}" id="error" class="toast-container toast-top-right">
    <div class="toast toast-error" aria-live="assertive" style="display: block;">
        <button type="button" class="toast-close-button" role="button"></button>
        <div class="toast-title">Error!</div>
        <div class="toast-message" th:text="${tbaoError}"></div>
    </div>
</div>
<!--Modal end-->
<script src="/js/jquery-3.6.0.min.js"></script>
<script src="/js/feather.min.js"></script>
<script src="/js/jquery.slimscroll.min.js"></script>
<script src="/js/bootstrap.bundle.min.js"></script>
<script src="/js/jquery.dataTables.min.js"></script>
<script src="/js/dataTables.bootstrap4.min.js"></script>
<script src="/plugins/select2/js/select2.min.js"></script>
<script src="/plugins/owlcarousel/owl.carousel.min.js"></script>
<script src="/plugins/sweetalert/sweetalert2.all.min.js"></script>
<script src="/plugins/sweetalert/sweetalerts.min.js"></script>
<script src="/js/script.js"></script>

<script>

</script>
<script>
    function validateAddKhachHang() {
        var hoTen = document.getElementById("hoTenKH").value;
        var soDienThoai = document.getElementById("sdtKH").value;
        var phoneRegex = /^0\d{9}$/;
        if (hoTen === "" || soDienThoai === "") {
            alert("Vui lòng điền đầy đủ thông tin");
            return false;
        }
        if (!phoneRegex.test(soDienThoai)) {
            alert("số điện thoại phải bắt đầu bằng số 0 và đủ 10 số");
            return false;
        }
        return true;
    }
</script>
<script>
    function tinhTienThua() {
        var tongTien = parseFloat(document.getElementById('tongTien').innerText.replace(' đ', ''));
        const buttonThanhToan = document.getElementById('nutThanhToan');
        var tienKhachDua = parseFloat(document.getElementById('tienKhachDua').value);

        var tienThua = tienKhachDua - tongTien;

        if (tienThua >= 0) {
            document.getElementById('tienThua').innerText = tienThua.toLocaleString('vi-VN') + ' đ';
            buttonThanhToan.disabled = false;
        } else {
            document.getElementById('tienThua').innerText = 'Không đủ tiền';
            buttonThanhToan.disabled = true;
        }
    }
</script>
<script>
    setTimeout(function () {
        var success = document.getElementById('success');
        if (success) {
            success.style.display = 'none';
        }
    }, 5000);
</script>
<script>
    setTimeout(function () {
        var error = document.getElementById('error');
        if (error) {
            error.style.display = 'none';
        }
    }, 5000);
</script>
<script>
    $(document).ready(function () {
        $('#chonTaiKhoan').modal('show');
    });
</script>
<script>
    $(document).ready(function () {
        $('#chonSize').modal('show');
    });
</script>
<script>
    $(document).ready(function () {
        $('#quetQR').modal('show');
    });
</script>
<script>
    $(document).ready(function () {
        $('#addKhachHang').modal('show');
    });
</script>

<script th:inline="javascript">
    /*<![CDATA[*/
    function updateTotalAmountAndGrandTotal(inputElement) {

        // Lấy giá trị số lượng từ input
        var quantity = parseInt(inputElement.value);
        var idCTG = inputElement.getAttribute('name');
        fetch('/ban-hang/updateQuantity', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'idCTG=' + encodeURIComponent(idCTG) + '&quantity=' + encodeURIComponent(quantity),
        })
            .then(response => response.text())
            .then(data => {
            })
            .catch(error => {
            });

        // Lấy giá trị giá bán từ phần tử cha
        var giaBan = parseInt(inputElement.closest('.product-lists').querySelector('.product-lists li:nth-child(2) div').innerText.replace(/[^0-9]/g, ''));

        // Tính tổng tiền và cập nhật vào phần tử hiển thị tổng tiền
        var totalAmountElement = inputElement.closest('.product-lists').querySelector('.product-lists li:nth-child(3) div');
        var totalAmount = giaBan * quantity;
        totalAmountElement.innerText = formatCurrency(totalAmount) + ' đ';

        // Cập nhật tổng tiền bên dưới
        updateGrandTotal();


        // Hàm cập nhật tổng tiền bên dưới
        function updateGrandTotal() {
            var totalElements = document.querySelectorAll('.product-lists li:nth-child(3) div');
            var grandTotalElement = document.querySelector('.setvalue h6');

            var grandTotal = 0;
            totalElements.forEach(function (element) {
                grandTotal += parseInt(element.innerText.replace(/[^0-9]/g, ''));
            });
            console.log(grandTotal);
            grandTotalElement.innerText = formatCurrency(grandTotal) + ' đ';
        }

        // Hàm định dạng số tiền thành chuỗi có định dạng
        function formatCurrency(amount) {
            return amount.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,').replace(/\.00/g, '');
        }
    }

    /*]]>*/
</script>
<script>
    function incrementQuantity(input) {
        var quantityInput = input.parentNode.querySelector('.quantityInput');
        var currentQuantity = parseInt(quantityInput.value);
        quantityInput.value = currentQuantity + 1;
        updateTotalAmountAndGrandTotal(quantityInput);
    }

    function decrementQuantity(input) {
        var quantityInput = input.parentNode.querySelector('.quantityInput');
        var currentQuantity = parseInt(quantityInput.value);
        if (currentQuantity > 0) {
            quantityInput.value = currentQuantity - 1;
            updateTotalAmountAndGrandTotal(quantityInput);
        }
    }
</script>

<script>
    var counter = 1;
    var maxButtons = 5;

    function createButton() {
        if (counter <= maxButtons) {
            var btn1 = document.getElementById("btn1");
            var newButton = document.createElement("button");
            newButton.className = "btn btn-outline-primary text-white newButton";
            newButton.innerHTML = "Hóa đơn" + counter;
            counter++;
            btn1.parentNode.insertBefore(newButton, btn1);
        } else {
            alert("Giới hạn 3 Hóa Đơn")
        }
    }
</script>
<script>
    document.querySelectorAll(".delete-button2").forEach(function (button) {
        button.addEventListener("click", function (event) {
            event.preventDefault(); // Ngăn chặn thực hiện chuyển hướng mặc định
            const QLUrl = button.getAttribute("data-ql-url");
            showConfirmationDialog(QLUrl);
        });
    });
</script>
<script>
    function showConfirmationDialog(QLUrl) {
        Swal.fire({
            title: "Vui lòng đăng nhập tài khoản ADMIN",
            text: "Bạn sẽ không thể hoàn tác hành động này!!",
            type: "Chú Ý",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Yes!",
            confirmButtonClass: "btn btn-primary",
            cancelButtonClass: "btn btn-danger ml-1",
            buttonsStyling: false
        }).then(function (result) {
            if (result.value) {
                // Chuyển hướng đến URL xóa
                window.location.href = QLUrl;
            } else if (result.dismiss === Swal.DismissReason.cancel) {
                // Xử lý khi người dùng hủy bỏ
                Swal.fire({
                    title: "Không Thành Công!",
                    type: "error",
                    confirmButtonClass: "btn btn-success"
                });
            }
        });
    }
</script>


<!--ngọc-->
<script>
    function tienSauKhuyenMai() {
        var tongTienSanPham = parseFloat(document.getElementById('tongTienSanPham').innerText.replace(' đ', ''));
        // const buttonThanhToan = document.getElementById('nutThanhToan');
        var giaTienGiam = parseFloat(document.getElementById('tienGiam').value);

        var tongTien = tongTienSanPham - giaTienGiam;
        // document.getElementById('tongTien').innerText = tongTien.toLocaleString() + "đ";
        document.getElementById('tongTien').innerText = tongTien.toLocaleString('vi-VN') + ' đ';

    }
</script>

</body>
</html>